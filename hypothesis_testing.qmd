# 假设检验

## 标准流程

1.  建立假设和确定显著性水平
    -   null hypothesis：$H_0$
    -   alternative hypothesis：$H_1$
    -   显著性水平/犯第$Ⅰ$类错误（拒绝真$H_0$）的概率/拒绝域的概率：$α$
2.  选择检验方法和计算检验统计量
    -   $z$检验，$t$检验，$\chi^2$检验，$F$检验，非参数检验等
3.  根据P值做出统计推断
    -   p≤α，拒绝$H_0$，接受$H_1$
    -   p＞α，不拒绝$H_0$

## 功效分析

1.  第$Ⅰ$类错误：拒绝真$H_0$，犯第Ⅰ类错误的概率$\alpha=P(reject\  H_0|H_0\ is\ True)$

2.  第$Ⅱ$类错误：不拒绝假$H_0$，犯第Ⅱ类错误的概率$\beta=(not\ reject\  H_0|H_1\ is\ True)$

3.  功效 $power=1-β=P(reject\  H0|H1 \ is\  True)$

4.  效应值 effect size

5.  样本量 sample size

## 假设检验与区间估计

如果参数$θ$的$(1-α)×100\%$置信区间CI包含参数$\theta_0$所有的估计值，那么不拒绝$H_0$;

如果参数$θ$的$(1-α)×100\%$置信区间CI不包含参数$\theta_0$任意一个估计值，那么拒绝$H_0$;

p value 和 CI 对于统计推断同等重要，尤其是大样本量。

## 一个总体参数的假设检验

### 均值------单样本$t$检验

$$t=\frac{\bar x-\mu_0}{S /\sqrt n} \sim t(\nu) $$

它是一种参数检验，用于检验小样本的均值是否可以合理地为特定值。

```{r}
set.seed(100)
x <- rnorm(30, mean = 10, sd = 0.5)
t.test(x, mu=10) 
t.test(x, mu=11) 
```

**单样本**$Z$**检验功效分析**

1.  双尾假设

    功效(power) $1-β\approx\Phi(z_{\alpha/2}+ES\sqrt n)$

    效应值(effect size) $ES=\frac{|\mu_1-\mu_2|}{\sigma}$

    样本量 $n=\frac{(z_{1-\alpha/2}+z_{1-\beta})^2}{ES^2}$

2.  单尾假设

    功效(power) $1-β=\Phi(z_{\alpha}+ES\sqrt n)$

    效应值(effect size) $ES=\frac{|\mu_1-\mu_2|}{\sigma}$

    样本量 $n=\frac{(z_{1-\alpha}+z_{1-\beta})^2}{ES^2}$

### 率------$Z$检验

$$
Z=\frac{p-\pi_0}{\sqrt{\pi_0(1-\pi_0)/n}}\sim N(0,1)
$$ 连续校正 $$
Z_{corr}=\frac{|p-\pi_0|-1/(2n)}{\sqrt{\pi_0(1-\pi_0)/n}}\sim N(0,1)
$$ **功效分析**

功效(power) $1-β\approx\Phi(\sqrt{\frac{\pi_0(1-\pi_0)}{\pi_1(1-\pi_1)}}(z_{\alpha/2}+\frac{|\pi_1-\pi_0|\sqrt n}{\sqrt{\pi_0(1-\pi_0)}}))$

样本量 $n=\frac{\pi_0(1-\pi_0))}{(\pi_1-\pi_0)^2}(z_{1-\alpha/2}+z_{1-\beta}\sqrt{\frac{\pi_0(1-\pi_0)}{\pi_1(1-\pi_1)}})$

## 两个总体参数的假设检验

```{r}
##两独立样本
library(MASS)
t.test(Prob~So,data=UScrime)
UScrime
##两非独立样本
library(MASS)
sapply(UScrime[c("U1","U2")], function(x)(c(mean=mean(x),sd=sd(x))))
with(UScrime,t.test(U1,U2,paired=TRUE))  #配对t检验
```

## $\chi^2$检验

## $F$检验

### Fisher F 检验

Fisher F 检验可用于检查两个样本是否具有相同的方差。或者，fligner.test（） 和 bartlett.test（） 可以用于相同的目的。

```{r}

```

## 非参数检验

#### **Wilcoxon Signed Rank Test**

在不假设正态分布时检验样本的平均值。Wilcoxon 符号秩检验可以替代 t 检验，尤其是当数据样本不假定服从正态分布时。它是一种非参数方法，用于测试估计值是否与其真实值不同。

```{r}
numeric_vector <- c(20, 29, 24, 19, 20, 22, 28, 23, 19, 19)
wilcox.test(numeric_vector, mu=20, conf.int = TRUE)
```

#### 双样本 t 检验和 Wilcoxon rank sum 检验

t.Test 和 Wilcoxon 秩检验都可用于比较 2 个样本的平均值。区别在于 t 检验假设被测试的样本是从正态分布中抽取的，而 Wilcoxon 的秩和检验则不然。

```{r}
x <- c(0.80, 0.83, 1.89, 1.04, 1.45, 1.38, 1.91, 1.64, 0.73, 1.46)
y <- c(1.15, 0.88, 0.90, 0.74, 1.21)

t.test(1:10, y = c(7:20)) 
wilcox.test(x, y, alternative = "g") # g for greater

# Use paired = TRUE for 1-to-1 comparison of observations.
t.test(x, y, paired = TRUE) # when observations are paired, use 'paired' argument.
wilcox.test(x, y, paired = TRUE) # both x and y are assumed to have similar shapes
```

```{r}
#Wilcoxon秩和检验  两组
with(UScrime,by(Prob,list(So=UScrime$So),median))
wilcox.test(Prob~So,data=UScrime)
#Wilcoxon符号秩和检验：非独立样本t检验的非参数替代方法
sapply(UScrime[c("U1","U2")], median)
with(UScrime,wilcox.test(U1,U2,paired=T))

#多组独立样本    kruskal.test(y~A,data)

states<-data.frame(state.region,state.x77)
kruskal.test(Illiteracy~state.region,data=states)
#非参数多重成对比较
 #source("https://rkabacoff.com/RiA/wmc.R")
source("wmc.R")
states <- data.frame(state.region, state.x77)
wmc(Illiteracy ~ state.region, data=states, method="holm") #Nonparametric multiple comparisons

#多组互不独立   # Friedman's rank sum non-parametric test 
friedman.test(y ~ A | B, data)
```
