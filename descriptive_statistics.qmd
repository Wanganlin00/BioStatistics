# 描述性统计学

## 数据类型

1.  定量数据（数值数据）

    i.  连续数据

    ii. 离散数据

2.  定性数据（分类数据）

    i.  无序分类数据

    ii. 有序分类数据

## 频数表和频率分布直方图

-   极差 $R=X_{max}-X_{min}$

-   组数$k$（$5-15$）

-   组别（$interval$）

-   频数$count$

-   频率$\frac{count}{n} \times 100\%$

## 数据特征

```{r}
as_tibble(mtcars$mpg)
```

### 集中趋势

```{r}
#算术平均数
mean(mtcars$mpg)     

#中位数
median(mtcars$mpg)   

#众数 mode
rstatix::get_mode(mtcars$mpg)
```

### 离散程度

```{r}
# 值域
range(mtcars$mpg)  
# 极差 / 全距
diff(range(mtcars$mpg) )  

# 分位数
quantile(mtcars$mpg,probs = c(0,0.1,0.25,0.5,0.75,1))    
# 四分位数间距
IQR(mtcars$mpg)      

# 标准差 standard deviation
sd(mtcars$mpg)       
# 方差 variance
var(mtcars$mpg)       


# 变异系数 Coefficient of Variation
CV <- function(x,na.rm=TRUE){  
    if(na.rm) x <- x[!is.na(x)]
    CV=sd(x)/mean(x)*100
    sprintf("%.2f%%",CV)
}
CV(mtcars$mpg)


# 绝对中位差 median absolute deviation
mad(mtcars$mpg,constant = 1.4826)

# 为了达到渐进正态一致性，`mad()` 的计算乘了一个比例因子`constant=1.4826`

median(abs(mtcars$mpg-median(mtcars$mpg)))
median(abs(mtcars$mpg-median(mtcars$mpg)))*1.4826
```

### 分布形状

偏度（Skewness）

:   表示随机变量概率分布的不对称性。

    <https://www.macroption.com/skewness-formula/>

    三阶中心矩。方差即二阶中心矩。

    $$ 
        Skew(X) =  \frac{E(X_i-E(X))^3}{Var(X)^{\frac{3}{2}}}\\ =E  [(\frac{X_i-\mu}{\sigma})^3]\\= \frac{1}{n} \sum_{i=1}^{n}  (\frac{X_i-\mu}{\sigma} )^3
    $$

    偏度的取值范围： $(-\infty,+\infty)$

    1.  Skew＜0，负偏态分布，左偏 = 尾部向左；

    2.  Skew=0，数据相对均匀的分布在均值两侧；

    3.  Skew＞0，正偏态分布，右偏 = 尾部向右。

```{r}
x <- c(1,2,3,5)
s <- psych::describeBy(x=x,group = NULL)
s$skew

skewness <- function(x,na.rm=TRUE){
    if(na.rm) x <- x[!is.na(x)]
    n=length(x)
    μ=mean(x)
    SD=sd(x)
    sknewness = mean(((x-μ)/SD)^3)
    return(sknewness=sknewness)
}
skewness(x)
```

峰度（Kurtosis）

:   表示随机变量概率分布的尖峭程度。四阶中心矩与方差平方的比值。

    <https://www.macroption.com/kurtosis-formula/>

    超值峰度 excess kurtosis ：四阶中心矩与方差平方的比值减3。

    <https://www.macroption.com/excess-kurtosis/>

    $$
    Kurt(X) =  \frac{E(X_i-E(X))^4}{Var(X)^{2}}-3\\= E  [(\frac{X_i-\mu}{\sigma})^4] - 3\\= \frac{1}{n} \sum_{i=1}^{n}  (\frac{X_i-\mu}{\sigma} )^4-3
    $$

    峰度的取值范围：$[1,+\infty)$

    超值峰度的取值范围：$[-2,+\infty)$

    1.  超值峰度＜0，数据分布与正态分布相比较为扁平；

    2.  超值峰度=0，正态分布；

    3.  超值峰度＞0，数据分布与正态分布相比较为高尖。

```{r}
s$kurtosis

kurtosis<-function(x,na.rm=TRUE){
    if(na.rm) x<-x[!is.na(x)]
    n=length(x)
    μ=mean(x)
    SD=sd(x)
    kurtosis= mean(((x-μ)/SD)^4)-3
    return(kurtosis=kurtosis)
}
kurtosis(x)
```

### 统计摘要

```{r}
summary(mtcars$mpg)
rstatix::get_summary_stats(mtcars,mpg,type = "full")
psych::describeBy(mtcars$mpg,group = mtcars$am)
```

## 统计表格

```{r}
options(digits = 2)
head(mtcars)

tbl1 <- tableone::CreateTableOne(vars = colnames(mtcars),
                                 data = mtcars,
                                 factorVars = c("cyl"), # 分类
                                 strata = c("am"),  #分层
                                 )
tbl1


```

复现 @fig-三线表

![](images/statistical-table.png){#fig-三线表 fig-align="center" width="80%"}

```{r}
data <- readRDS("data/brfss_tg_2014_raw.rds")
data <- data |> 
    tidyr::drop_na() |>
    dplyr::filter(TRNSGNDR <= 3) |> 
    dplyr::filter(`_AGEG5YR` >= 5 & `_AGEG5YR` <= 11) |> 
    dplyr::select(- c(HADMAM, `_AGE80`))

data_recoded <- data |> 
    dplyr::mutate(TRNSGNDR = forcats::as_factor(TRNSGNDR)) |> 
    dplyr::mutate(TRNSGNDR = 
          forcats::fct_recode(TRNSGNDR, "Male to female" = "1")) |> 
    dplyr::mutate(TRNSGNDR = 
          forcats::fct_recode(TRNSGNDR, "Female to male" = "2")) |> 
    dplyr::mutate(TRNSGNDR = 
            forcats::fct_recode(TRNSGNDR, "Gender non-conforming" = "3")) |> 
    
    dplyr::mutate(`_AGEG5YR` = forcats::as_factor(`_AGEG5YR`)) |> 
    dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "40-44" = "5")) |> 
    dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "45-49" = "6")) |> 
    dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "50-54" = "7")) |> 
    dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "55-59" = "8")) |> 
    dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "60-64" = "9")) |> 
    dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "65-69" = "10")) |> 
        dplyr::mutate(`_AGEG5YR` = 
          forcats::fct_recode(`_AGEG5YR`, "70-74" = "11")) |> 
    
    dplyr::mutate(`_RACE` = forcats::as_factor(`_RACE`)) |> 
    dplyr::mutate(`_RACE` = 
          forcats::fct_recode(`_RACE`, "White" = "1")) |> 
    dplyr::mutate(`_RACE` = 
          forcats::fct_recode(`_RACE`, "Black" = "2")) |> 
    dplyr::mutate(`_RACE` = 
          forcats::fct_recode(`_RACE`, "Native American" = "3")) |> 
    dplyr::mutate(`_RACE` = 
          forcats::fct_recode(`_RACE`, "Asian/Pacific Islander" = "4")) |> 
    dplyr::mutate(`_RACE` = 
          forcats::fct_collapse(`_RACE`, "Other" = 
                c("5", "7", "8", "9"))) |> 
    
    dplyr::mutate(`_INCOMG` = forcats::as_factor(`_INCOMG`)) |> 
    dplyr::mutate(`_INCOMG` = 
          forcats::fct_recode(`_INCOMG`, "Less than $15,000" = "1")) |> 
    dplyr::mutate(`_INCOMG` = 
          forcats::fct_recode(`_INCOMG`, "$15,000 to less than $25,000" = "2")) |> 
    dplyr::mutate(`_INCOMG` = 
          forcats::fct_recode(`_INCOMG`, "$25,000 to less than $35,000" = "3")) |> 
    dplyr::mutate(`_INCOMG` = 
          forcats::fct_recode(`_INCOMG`, "$35,000 to less than $50,000" = "4")) |> 
    dplyr::mutate(`_INCOMG` = 
          forcats::fct_recode(`_INCOMG`, "$50,000 or more" = "5")) |> 
    dplyr::mutate(`_INCOMG` = 
          forcats::fct_recode(`_INCOMG`, "Don't know/not sure/missing" = "9")) |>  

    dplyr::mutate(`_EDUCAG` = forcats::as_factor(`_EDUCAG`)) |> 
    dplyr::mutate(`_EDUCAG` = 
          forcats::fct_recode(`_EDUCAG`, "Did not graduate highschool" = "1")) |> 
    dplyr::mutate(`_EDUCAG` = 
          forcats::fct_recode(`_EDUCAG`, "Graduated highschool" = "2")) |> 
    dplyr::mutate(`_EDUCAG` = 
          forcats::fct_recode(`_EDUCAG`, "Attended college/technical school" = "3")) |> 
    dplyr::mutate(`_EDUCAG` = 
          forcats::fct_recode(`_EDUCAG`, "Graduated from college/technical school" = "4")) |> 
    
    dplyr::mutate(HLTHPLN1 = forcats::as_factor(HLTHPLN1)) |> 
    dplyr::mutate(HLTHPLN1 = 
          forcats::fct_recode(HLTHPLN1, "Yes" = "1")) |> 
    dplyr::mutate(HLTHPLN1 = 
          forcats::fct_recode(HLTHPLN1, "No" = "2")) |> 
    
    dplyr::mutate(PHYSHLTH = dplyr::case_match(PHYSHLTH, 
                 77 ~ NA,
                 99 ~ NA,
                 88 ~ 0,
                 .default = PHYSHLTH)) |> 

    labelled::set_variable_labels(
        TRNSGNDR = "Transition status",
        `_AGEG5YR` = "Age category",
        `_RACE` = "Race/ethnicity",
        `_INCOMG` = "Income category",
        `_EDUCAG` = "Education category",
        HLTHPLN1 = "Health insurance?",
        PHYSHLTH = "Days poor physical health per month"
    )


tbl1_gtsummary <- data_recoded |> 
    gtsummary::tbl_summary(
        statistic = list(
            gtsummary::all_continuous() ~ "{median}",
            gtsummary::all_categorical() ~ "{n}"
            ), 
         label = PHYSHLTH ~ "Days poor physical health per month (median, IQR)"
    )

tbl2_gtsummary <- data_recoded |> 
    gtsummary::tbl_summary(
        statistic = list(
            gtsummary::all_continuous() ~ "({p25}, {p75})",
            gtsummary::all_categorical() ~ "{p}%"
            ),
        digits = list(gtsummary::all_categorical() ~ 1),
        label = PHYSHLTH ~ "Days poor physical health per month (median, IQR)"
    )

tbl_merge_gtsummary <- gtsummary::tbl_merge(
    list(tbl1_gtsummary, tbl2_gtsummary)
) |> 
    gtsummary::bold_labels() |> 
    gtsummary::modify_header(
        list(
            label ~ "**Survey participants demographics (N = {n})**",
            stat_0_1 ~ "**Frequency**", 
            stat_0_2 ~ "**Percent**"
        )
    ) |> 
    gtsummary::modify_spanning_header(gtsummary::everything() ~ NA) |> 
    gtsummary::modify_footnote(gtsummary::everything() ~ NA) 

tbl_merge_gtsummary
```

```{r}
tbl_merge_gtsummary_small <- tbl_merge_gtsummary |> 
    gtsummary::as_gt() |> 
    gt::tab_options(table.font.size = "14px")

tbl_merge_gtsummary_small
```

```{r}
gtsummary::theme_gtsummary_compact() 
tbl_merge_gtsummary
```

## 数据可视化

[R Notes](https://wanganlin00.github.io/R/)

-   base_graphics
-   ggplot2_graphics
