```{r}
install.packages(c("coin"))
install.packages("lmPerm")

options(digits = 4)
################################  coin包的置换检验   #################################
score<-c(40,57,45,55,58,57,64,55,62,65)
library(coin)
treatment<-factor(c(rep("A",5),rep("B",5)))
mydata<-data.frame(treatment,score)
t.test(score~treatment,data=mydata,var.equal=TRUE)   #传统t检验显著性差异
oneway_test(score~treatment,data=mydata,distribution="exact") #置换检验差异不显著

library(MASS)
crime<-transform(UScrime,So=factor(So))
wilcox_test(Prob~So,data=crime,distribution="exact")

library(multcomp)
set.seed(2)
oneway_test(response~trt,data=cholesterol,distribution="approximate")

#列联表中的独立性
library(vcd)
Arthritis<-transform(Arthritis,Improved=as.factor(as.numeric(Improved)))
set.seed(2)
chisq_test(Treatment~Improved,data=Arthritis,distribution="approximate")

#数值变量间的独立性
states<-as.data.frame(state.x77)
set.seed(2)
spearman_test(Illiteracy~Murder,data=states,distribution="approximate")

#相关性检验
wilcoxsign_test(U1~U2,data=UScrime,distribute="exact")   #两配对组


################################  lmPerm包的置换检验   #########################
#线性模型 lm()  aov()的置换检验

library(lmPerm)
set.seed(2)
fit1<-lmp(weight~height,data=women,perm = "Prob")  #简单线性回归的置换检验
summary(fit1)

set.seed(12)
fit2<-lmp(weight~height+I(height^2),data=women,prem="Prob") #多项式回归的置换检验
summary(fit2)


set.seed(24)
states<-as.data.frame(state.x77)               #多元线性回归
fit3<-lmp(Murder~Population+Illiteracy+Income+Frost,data = states,perm = "Prob")
summary(fit3)

set.seed(42)
fit4<-aovp(response~trt,data=cholesterol,perm="Prob") #单因素方差分析
anova(fit4)

set.seed(425)
fit5<-aovp(weight~gesttime+dose,data=litter,perm="Prob") #单因素协方差分析
anova(fit5)

set.seed(242)
fit6<-aovp(len~supp*dose,data=ToothGrowth,perm="Prob")
anova(fit6)


################################   boot包的自助法   ############################
install.packages("boot")

#对单个统计量使用自助法
r2<-function(formula,data,indices) {
  d<-data[indices,]
  fit<-lm(formula,data=d)
  return(summary(fit)$r.square)
}                                        #先创建一个返回待研究统计量的函数

library(boot)
set.seed(114)
result<-boot(data=mtcars,statistic = r2,R=1000,formula=mpg~wt+disp)  #boot() 自助抽样
print(result)
plot(result)


boot.ci(result,conf=0.95,type ="all")   #根据boot()返回值生成置信区间

#对多个统计量使用自助法
beta<-function(formula,data,indices){
  d<-data[indices,]
  fit<-lm(formula,data=d)
  return(coef(fit))
}
library(boot)
set.seed(1234)
results<-boot(data=mtcars,statistic = beta,R=1000,formula=mpg~wt+disp)  #boot() 自助抽样
print(results)
for (i in 1:3) plot(results,index=i)

boot.ci(results,conf = .95,type = "bca",index = 2)
boot.ci(results,conf = .95,type = "bca",index = 3)

```

